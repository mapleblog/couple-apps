<html>
  <head>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Plus+Jakarta+Sans%3Awght%40400%3B500%3B700%3B800"
    />

    <title>Stitch Design</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    <link rel="stylesheet" href="styles.css" />

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="script.js" defer></script>
  </head>
  <body>
    <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
    <div id="userInfoHeader" class="hidden fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-pink-500 via-purple-500 to-pink-600 shadow-lg">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <!-- ç”¨æˆ·ä¿¡æ¯ -->
                <div class="flex items-center space-x-3">
                    <img id="userAvatar" src="" alt="ç”¨æˆ·å¤´åƒ" class="w-10 h-10 rounded-full border-2 border-white shadow-md">
                    <div class="text-white">
                        <div id="userName" class="font-semibold text-sm">ç”¨æˆ·å</div>
                        <div id="userEmail" class="text-xs opacity-90">ç”¨æˆ·é‚®ç®±</div>
                    </div>
                </div>
                
                <!-- ç™»å‡ºæŒ‰é’® -->
                <button id="logoutBtn" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 backdrop-blur-sm border border-white/20 hover:border-white/40">
                    <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    Logout
                </button>
            </div>
        </div>
    </div>
    
    <!-- ç™»å½•æç¤º -->
    <div id="loginPrompt" class="hidden fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-pink-500 via-purple-500 to-pink-600 shadow-lg">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="text-white">
                    <div class="font-semibold text-sm">æ¬¢è¿æ¥åˆ°æƒ…ä¾£ç©ºé—´</div>
                    <div class="text-xs opacity-90">è¯·ç™»å½•ä»¥äº«å—å®Œæ•´åŠŸèƒ½</div>
                </div>
                
                <a href="loginpange.html" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 backdrop-blur-sm border border-white/20 hover:border-white/40">
                    <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m0 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                    </svg>
                    ç«‹å³ç™»å½•
                </a>
            </div>
        </div>
    </div>
    <div
      class="relative flex size-full min-h-screen flex-col bg-[#22111a] dark group/design-root overflow-x-hidden main-container pt-16"
    >
      <div class="layout-container flex h-full grow flex-col">
        <div class="px-40 flex flex-1 justify-center py-5">
          <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
            <div class="@container">
              <div class="@[480px]:px-4 @[480px]:py-3">
                <img
                  src="pic/disneyland-paris.jpg"
                  alt="Hero Image"
                  class="w-full flex flex-col justify-end overflow-hidden @[480px]:rounded-lg min-h-80 object-cover"
                />
              </div>
            </div>
            <!-- Audio element -->
            <audio id="musicPlayer" preload="metadata">
              <source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.wav" type="audio/wav">
              <source src="https://file-examples.com/storage/fe68c8777b8ee92b7d07f27/2017/11/file_example_MP3_700KB.mp3" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
            
            <div class="px-4 py-3">
              <div class="flex flex-col gap-3 rounded-lg bg-[#482336] px-4 py-3" id="musicPlayerContainer">
                <!-- Main player info -->
                <div class="flex items-center gap-4 overflow-hidden">
                  <div
                    class="bg-center bg-no-repeat aspect-square bg-cover rounded-lg size-14 shrink-0 music-avatar"
                  ></div>
                  <div class="flex-1">
                    <p class="text-white text-base font-bold leading-tight truncate" id="currentSongTitle">Romantic Music</p>
                    <p class="text-[#c992ad] text-sm font-normal leading-normal truncate" id="currentArtist">Various Artists</p>
                  </div>

                </div>
                
                <!-- Progress bar and time display -->
                <div class="flex items-center gap-3">
                  <span class="text-[#c992ad] text-xs font-medium" id="currentTime">0:00</span>
                  <div class="flex-1 relative">
                    <div class="w-full h-1 bg-[#22111a] rounded-full">
                      <div class="h-1 bg-[#f04299] rounded-full transition-all duration-300" id="progressBar" style="width: 0%"></div>
                    </div>
                    <input type="range" min="0" max="100" value="0" class="absolute inset-0 w-full h-1 opacity-0 cursor-pointer" id="progressSlider">
                  </div>
                  <span class="text-[#c992ad] text-xs font-medium" id="totalTime">0:00</span>
                </div>
                
                <!-- Playback control buttons -->
                <div class="flex items-center justify-center gap-4">
                  <button class="flex items-center justify-center size-8 text-white hover:text-[#f04299] transition-colors" id="prevBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                      <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"/>
                    </svg>
                  </button>
                  <button class="flex items-center justify-center size-10 bg-[#f04299] text-white rounded-full hover:bg-[#e03a8a] transition-colors" id="mainPlayPauseBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256" id="mainPlayPauseIcon">
                      <path d="M240,128a15.74,15.74,0,0,1-7.6,13.51L88.32,229.65a16,16,0,0,1-16.2.3A15.86,15.86,0,0,1,64,216.13V39.87a15.86,15.86,0,0,1,8.12-13.82,16,16,0,0,1,16.2.3L232.4,114.49A15.74,15.74,0,0,1,240,128Z"/>
                    </svg>
                  </button>
                  <button class="flex items-center justify-center size-8 text-white hover:text-[#f04299] transition-colors" id="nextBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                      <path d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z"/>
                    </svg>
                  </button>
                </div>
                
                <!-- Volume control -->
                <div class="flex items-center gap-3">
                  <button class="flex items-center justify-center size-6 text-[#c992ad] hover:text-white transition-colors" id="muteBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="currentColor" viewBox="0 0 256 256" id="volumeIcon">
                      <path d="M155.51,24.81a8,8,0,0,0-8.42.88L77.25,80H32A16,16,0,0,0,16,96v64a16,16,0,0,0,16,16H77.25l69.84,54.31A8,8,0,0,0,160,224V32A8,8,0,0,0,155.51,24.81ZM144,207.64,81.25,161.69A8,8,0,0,0,76,160H32V96H76a8,8,0,0,0,5.25-1.69L144,48.36Zm54-106.08a24,24,0,0,1,0,36.88,8,8,0,0,1-12-10.58,8,8,0,0,0,0-15.72,8,8,0,0,1,12-10.58ZM248,128a79.9,79.9,0,0,1-20.37,53.34,8,8,0,0,1-11.92-10.67,64,64,0,0,0,0-85.33,8,8,0,1,1,11.92-10.67A79.83,79.83,0,0,1,248,128Z"/>
                    </svg>
                  </button>
                  <div class="flex-1 relative">
                    <div class="w-full h-1 bg-[#22111a] rounded-full">
                      <div class="h-1 bg-[#c992ad] rounded-full transition-all duration-300" id="volumeBar" style="width: 70%"></div>
                    </div>
                    <input type="range" min="0" max="100" value="70" class="absolute inset-0 w-full h-1 opacity-0 cursor-pointer" id="volumeSlider">
                  </div>
                  <span class="text-[#c992ad] text-xs font-medium w-8 text-right" id="volumeDisplay">70%</span>
                </div>
              </div>
            </div>
            <h1 class="text-white tracking-light text-[32px] font-bold leading-tight px-4 text-center pb-3 pt-6">We've been together</h1>
            <!-- Days counter blocks - Left-right layout -->
            <div class="flex flex-col sm:flex-row gap-2 pb-3 pt-6 px-4">
              <div class="flex-1">
                <h1 id="daysCounter1" class="text-white tracking-light text-[32px] font-bold leading-tight text-center">1,234 days</h1>
              </div>
              <div class="flex-1">
                <h1 id="daysCounter2" class="text-white tracking-light text-[32px] font-bold leading-tight text-center">0 days</h1>
              </div>
            </div>
            <!-- Since date blocks - Left-right layout -->
            <div class="flex flex-col sm:flex-row gap-2 pb-3 pt-1 px-4">
              <div class="flex-1">
                <p class="text-white text-base font-normal leading-normal text-center">Since 05.05.2025</p>
              </div>
              <div class="flex-1">
                <p class="text-white text-base font-normal leading-normal text-center">Since 06.06.2025</p>
              </div>
            </div>
            <div class="flex flex-wrap items-center justify-center gap-6 p-4" id="calendarContainer">
              <div class="flex min-w-72 max-w-[336px] flex-1 flex-col gap-0.5">
                <div class="flex items-center p-1 justify-between">
                  <button id="prevMonthBtn">
                    <div class="text-white flex size-10 items-center justify-center" data-icon="CaretLeft" data-size="18px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"></path>
                      </svg>
                    </div>
                  </button>
                  <p class="text-white text-base font-bold leading-tight flex-1 text-center" id="currentMonthYear">2020-01</p>
                  <button id="nextMonthBtn">
                    <div class="text-white flex size-10 items-center justify-center" data-icon="CaretRight" data-size="18px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z"></path>
                      </svg>
                    </div>
                  </button>
                </div>
                <div class="grid grid-cols-7" id="calendarGrid">
                  <p class="text-white text-[13px] font-bold leading-normal tracking-[0.015em] flex h-12 w-full items-center justify-center pb-0.5">S</p>
                  <p class="text-white text-[13px] font-bold leading-normal tracking-[0.015em] flex h-12 w-full items-center justify-center pb-0.5">M</p>
                  <p class="text-white text-[13px] font-bold leading-normal tracking-[0.015em] flex h-12 w-full items-center justify-center pb-0.5">T</p>
                  <p class="text-white text-[13px] font-bold leading-normal tracking-[0.015em] flex h-12 w-full items-center justify-center pb-0.5">W</p>
                  <p class="text-white text-[13px] font-bold leading-normal tracking-[0.015em] flex h-12 w-full items-center justify-center pb-0.5">T</p>
                  <p class="text-white text-[13px] font-bold leading-normal tracking-[0.015em] flex h-12 w-full items-center justify-center pb-0.5">F</p>
                  <p class="text-white text-[13px] font-bold leading-normal tracking-[0.015em] flex h-12 w-full items-center justify-center pb-0.5">S</p>
                  <!-- Dates will be dynamically generated by JavaScript -->
                </div>
              </div>
            </div>
            <!-- Couple avatar area - Modified to support custom image insertion -->
            <div class="grid grid-cols-[repeat(auto-fit,minmax(158px,1fr))] gap-3 p-4">
              <div class="flex flex-col gap-3 pb-3">
                <!-- Clara's avatar - Changed to img element to support custom images -->
                <img
                  id="clara-avatar"
                  src="pic/profile1.jpg"
                  alt="Khang Khang"
                  class="w-full bg-center bg-no-repeat aspect-square bg-cover rounded-lg object-cover"
                />
                <div>
                  <p class="text-white text-base font-medium leading-normal">Dinh Khang</p>
                  <p class="text-[#c992ad] text-sm font-normal leading-normal">Malaysia</p>
                  <p class="text-[#c992ad] text-sm font-normal leading-normal">28-02-1991</p>
                </div>
              </div>
              <div class="flex flex-col gap-3 pb-3">
                <!-- Ethan's avatar - Changed to img element to support custom images -->
                <img
                  id="ethan-avatar"
                  src="pic/profile.png"
                  alt="Trung Trung"
                  class="w-full bg-center bg-no-repeat aspect-square bg-cover rounded-lg object-cover"
                />
                <div>
                  <p class="text-white text-base font-medium leading-normal">Thuy Trang</p>                  
                  <p class="text-[#c992ad] text-sm font-normal leading-normal">Vietnam</p>
                  <p class="text-[#c992ad] text-sm font-normal leading-normal">18-01-2000</p>
                </div>
              </div>
            </div>

            <div class="flex items-center justify-between px-4 pb-3 pt-5">
              <h2 class="text-white text-[22px] font-bold leading-tight tracking-[-0.015em]">Love Notes</h2>
              <button id="addNoteBtn" class="flex items-center justify-center size-8 bg-[#f04299] text-white rounded-full hover:bg-[#e03a8a] transition-colors duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"/>
                </svg>
              </button>
            </div>
            <div id="loveNotesContainer" class="love-notes-grid">
              <!-- Love notes will be dynamically generated here -->
            </div>
            
            <!-- Love Notes Pagination -->
            <div id="loveNotesPagination" class="flex items-center justify-center gap-4 px-4 pb-4" style="display: none;">
              <button id="prevPageBtn" class="flex items-center justify-center w-8 h-8 bg-[#482336] text-white rounded-full hover:bg-[#5a2a42] transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"/>
                </svg>
              </button>
              
              <span id="pageInfo" class="text-[#c992ad] text-sm font-medium min-w-[3rem] text-center">1 / 1</span>
              
              <button id="nextPageBtn" class="flex items-center justify-center w-8 h-8 bg-[#482336] text-white rounded-full hover:bg-[#5a2a42] transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z"/>
                </svg>
              </button>
            </div>


          </div>
        </div>
      </div>
    </div>
    <!-- Love Notes Modal -->
    <div id="loveNoteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-[#1a0d14] rounded-lg p-6 w-full max-w-md mx-4 border border-[#482336]">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-white text-xl font-bold">Create Love Note</h3>
          <button id="closeModalBtn" class="text-[#c992ad] hover:text-white transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
              <path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128l66.35,66.34A8,8,0,0,1,205.66,194.34Z"/>
            </svg>
          </button>
        </div>
        
        <form id="loveNoteForm" class="space-y-4">
          <div>
            <label for="noteTitle" class="block text-[#c992ad] text-sm font-medium mb-2">Title</label>
            <input type="text" id="noteTitle" name="title" required 
                   class="w-full px-3 py-2 bg-[#22111a] border border-[#482336] rounded-lg text-white placeholder-[#c992ad] focus:outline-none focus:border-[#f04299] transition-colors"
                   placeholder="Enter note title..." maxlength="50">
          </div>
          
          <div>
            <label for="noteContent" class="block text-[#c992ad] text-sm font-medium mb-2">Content</label>
            <div class="relative">
              <textarea id="noteContent" name="content" required rows="4"
                        class="w-full px-3 py-2 pr-10 bg-[#22111a] border border-[#482336] rounded-lg text-white placeholder-[#c992ad] focus:outline-none focus:border-[#f04299] transition-colors resize-none"
                        placeholder="Write your love note..." maxlength="200"></textarea>
              <button type="button" id="emojiBtn" class="absolute bottom-2 right-2 text-[#c992ad] hover:text-white transition-colors p-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                  <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216ZM80,108a12,12,0,1,1,12,12A12,12,0,0,1,80,108Zm96,0a12,12,0,1,1-12-12A12,12,0,0,1,176,108Zm-1.08,48c-10.29,17.79-27.39,28-46.92,28s-36.63-10.2-46.92-28a8,8,0,1,1,13.84-8c7.47,12.91,19.21,20,33.08,20s25.61-7.1,33.08-20a8,8,0,1,1,13.84,8Z"/>
                </svg>
              </button>
            </div>
            <!-- Emoji picker -->
            <div id="emojiPicker" class="hidden mt-2 p-3 bg-[#22111a] border border-[#482336] rounded-lg max-h-32 overflow-y-auto">
              <div class="grid grid-cols-8 gap-1 text-lg">
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ˜€</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ˜</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ¥°</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ˜˜</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ’•</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ’–</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ’—</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ’“</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ’</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ’</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ’Ÿ</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">â¤ï¸</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ§¡</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ’›</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ’š</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ’™</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ’œ</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ–¤</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ¤</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸ¤</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸŒ¹</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸŒº</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸŒ¸</button>
                <button type="button" class="emoji-option hover:bg-[#482336] p-1 rounded transition-colors">ğŸŒ»</button>
              </div>
            </div>
          </div>
          
          <div>
            <label class="block text-[#c992ad] text-sm font-medium mb-2">Background Color</label>
            <div class="grid grid-cols-4 gap-2">
              <button type="button" class="color-option w-full h-10 rounded-lg border-2 border-transparent hover:border-white transition-colors" 
                      data-color="linear-gradient(135deg, #667eea 0%, #764ba2 100%)" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)"></button>
              <button type="button" class="color-option w-full h-10 rounded-lg border-2 border-transparent hover:border-white transition-colors" 
                      data-color="linear-gradient(135deg, #f093fb 0%, #f5576c 100%)" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"></button>
              <button type="button" class="color-option w-full h-10 rounded-lg border-2 border-transparent hover:border-white transition-colors" 
                      data-color="linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"></button>
              <button type="button" class="color-option w-full h-10 rounded-lg border-2 border-transparent hover:border-white transition-colors" 
                      data-color="linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"></button>
              <button type="button" class="color-option w-full h-10 rounded-lg border-2 border-transparent hover:border-white transition-colors" 
                      data-color="linear-gradient(135deg, #fa709a 0%, #fee140 100%)" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%)"></button>
              <button type="button" class="color-option w-full h-10 rounded-lg border-2 border-transparent hover:border-white transition-colors" 
                      data-color="linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)"></button>
              <button type="button" class="color-option w-full h-10 rounded-lg border-2 border-transparent hover:border-white transition-colors" 
                      data-color="linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)"></button>
              <button type="button" class="color-option w-full h-10 rounded-lg border-2 border-transparent hover:border-white transition-colors" 
                      data-color="linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)" style="background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)"></button>
            </div>
            <input type="hidden" id="selectedColor" name="backgroundColor" value="linear-gradient(135deg, #667eea 0%, #764ba2 100%)">
          </div>
          
          <div class="flex gap-3 pt-4">
            <button type="button" id="cancelBtn" class="flex-1 px-4 py-2 bg-[#482336] text-white rounded-lg hover:bg-[#5a2a42] transition-colors">
              Cancel
            </button>
            <button type="submit" class="flex-1 px-4 py-2 bg-[#f04299] text-white rounded-lg hover:bg-[#e03a8a] transition-colors">
              Create Note
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <!-- Firebase configuration and authentication modules -->
    <script src="firebase-config.js"></script>
    <script src="auth.js"></script>
    <script src="auth-guard.js"></script>
    <script src="firebase-db.js"></script>
    
    <!-- Avatar management script -->
    <script src="avatar-manager.js"></script>
    <!-- Video configuration file -->
    <script src="video-config.js"></script>
    
    <!-- User Authentication Script -->
    <script>
        // é¡µé¢è®¤è¯å’Œç”¨æˆ·ä¿¡æ¯ç®¡ç†
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ä¸»é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–è®¤è¯çŠ¶æ€');
            
            // ç­‰å¾…è®¤è¯æœåŠ¡åˆå§‹åŒ–
            await waitForAuthServices();
            
            // åˆå§‹åŒ–è®¤è¯çŠ¶æ€ç›‘å¬
            initAuthStateListener();
            
            // ç»‘å®šç™»å‡ºæŒ‰é’®äº‹ä»¶
            bindLogoutEvent();
        });
      
        /**
         * ç­‰å¾…è®¤è¯æœåŠ¡åˆå§‹åŒ–
         */
        async function waitForAuthServices() {
            let attempts = 0;
            const maxAttempts = 50;
            
            while (attempts < maxAttempts) {
                if (window.AuthManager && window.AuthManager.instance) {
                    console.log('è®¤è¯æœåŠ¡å·²å°±ç»ª');
                    return true;
                }
                
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }
            
            console.warn('è®¤è¯æœåŠ¡åˆå§‹åŒ–è¶…æ—¶');
            return false;
        }
      
        /**
         * åˆå§‹åŒ–è®¤è¯çŠ¶æ€ç›‘å¬
         */
        function initAuthStateListener() {
            if (!window.AuthManager || !window.AuthManager.onAuthStateChanged) {
                console.warn('è®¤è¯ç®¡ç†å™¨æœªåŠ è½½æˆ–æ–¹æ³•ä¸å¯ç”¨ï¼Œæ˜¾ç¤ºç™»å½•æç¤º');
                showLoginPrompt();
                return;
            }
            
            // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
            window.AuthManager.onAuthStateChanged((user) => {
                console.log('è®¤è¯çŠ¶æ€å˜åŒ–:', user ? 'å·²ç™»å½•' : 'æœªç™»å½•');
                
                if (user) {
                    showUserInfo(user);
                    hideLoginPrompt();
                } else {
                    hideUserInfo();
                    showLoginPrompt();
                }
            });
        }
      
        /**
         * æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
         */
        function showUserInfo(user) {
            const userInfoHeader = document.getElementById('userInfoHeader');
            const userAvatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            const userEmail = document.getElementById('userEmail');
            
            if (userInfoHeader && userAvatar && userName && userEmail) {
                // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
                userAvatar.src = user.photoURL || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNmMDQyOTkiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIGZpbGw9IndoaXRlIiB2aWV3Qm94PSIwIDAgMjU2IDI1NiI+CjxwYXRoIGQ9Ik0yMzAuOTIsMjEyYy0xNS4yMy0yNi4zMy0zOC43LTQ1LjIxLTY2LjA5LTU0LjE2YTcyLDcyLDAsMSwwLTczLjY2LDBDNjMuNzgsMTY2Ljc4LDQwLjMxLDE4NS42NiwyNS4wOCwyMTJhOCw4LDAsMSwwLDEzLjg1LDhjMTguODQtMzIuNTYsNTIuMTQtNTIsODkuMDctNTJzNzAuMjMsMTkuNDQsODkuMDcsNTJhOCw4LDAsMSwwLDEzLjg1LThaTTcyLDk2YTU2LDU2LDAsMSwxLDU2LDU2QTU2LjA2LDU2LjA2LDAsMCwxLDcyLDk2WiIvPgo8L3N2Zz4KPC9zdmc+';
                userName.textContent = user.displayName || 'ç”¨æˆ·';
                userEmail.textContent = user.email || '';
                
                // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯å¤´éƒ¨
                userInfoHeader.classList.remove('hidden');
                
                console.log('ç”¨æˆ·ä¿¡æ¯å·²æ˜¾ç¤º:', {
                    name: user.displayName,
                    email: user.email,
                    photo: user.photoURL
                });
            }
        }
      
        /**
         * éšè—ç”¨æˆ·ä¿¡æ¯
         */
        function hideUserInfo() {
            const userInfoHeader = document.getElementById('userInfoHeader');
            if (userInfoHeader) {
                userInfoHeader.classList.add('hidden');
            }
        }
        
        /**
         * æ˜¾ç¤ºç™»å½•æç¤º
         */
        function showLoginPrompt() {
            const loginPrompt = document.getElementById('loginPrompt');
            if (loginPrompt) {
                loginPrompt.classList.remove('hidden');
            }
        }
        
        /**
         * éšè—ç™»å½•æç¤º
         */
        function hideLoginPrompt() {
            const loginPrompt = document.getElementById('loginPrompt');
            if (loginPrompt) {
                loginPrompt.classList.add('hidden');
            }
        }
      
        /**
         * ç»‘å®šç™»å‡ºæŒ‰é’®äº‹ä»¶
         */
        function bindLogoutEvent() {
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }
        }
        
        /**
         * å¤„ç†ç™»å‡º
         */
        async function handleLogout() {
            try {
                if (!window.AuthManager) {
                    console.warn('è®¤è¯ç®¡ç†å™¨æœªåŠ è½½');
                    return;
                }
                
                console.log('å¼€å§‹ç™»å‡ºæµç¨‹');
                
                const result = await window.AuthManager.signOut();
                
                if (result.success) {
                    console.log('ç™»å‡ºæˆåŠŸ');
                    // è®¤è¯çŠ¶æ€ç›‘å¬å™¨ä¼šè‡ªåŠ¨å¤„ç†UIæ›´æ–°
                } else {
                    console.error('ç™»å‡ºå¤±è´¥:', result.message);
                    alert('ç™»å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            } catch (error) {
                console.error('ç™»å‡ºè¿‡ç¨‹å‡ºé”™:', error);
                alert('ç™»å‡ºè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯');
            }
        }
    </script>
  </body>
</html>

